<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using the pydidas processing pipeline &mdash; pydidas</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/_css/pydidas-custom.css?v=9d9b2af9" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=41fa6165"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Code documentation" href="../../../code/code_documentation.html" />
    <link rel="prev" title="Composite image creator frame" href="../frames/CompositeCreatorFrame.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #4444AA" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pydidas
              <img src="../../../_static/pydidas_snakes_circ_bg.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                23.12.08
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../manuals.html">Manuals</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../commandline.html">Command line manuals</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../graphical_user_interface.html">Graphical user interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../graphical_user_interface.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../graphical_user_interface.html#the-ui-state">The UI state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../graphical_user_interface.html#generic-gui-information">Generic GUI information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../graphical_user_interface.html#frames">Frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../graphical_user_interface.html#windows">Windows</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../graphical_user_interface.html#recipes">Recipes</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Using the pydidas processing pipeline</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#detector-calibration">1. Detector calibration</a></li>
<li class="toctree-l5"><a class="reference internal" href="#define-the-experimental-setup">2. Define the experimental setup</a></li>
<li class="toctree-l5"><a class="reference internal" href="#define-the-scan">3. Define the scan</a></li>
<li class="toctree-l5"><a class="reference internal" href="#creating-the-workflow">4. Creating the workflow</a></li>
<li class="toctree-l5"><a class="reference internal" href="#testing-the-workflow">5. Testing the workflow</a></li>
<li class="toctree-l5"><a class="reference internal" href="#running-the-full-workflow">6. Running the full workflow</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/code_documentation.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide.html">Developer guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #4444AA" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pydidas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../manuals.html">Manuals</a></li>
          <li class="breadcrumb-item"><a href="../graphical_user_interface.html">Graphical user interface</a></li>
      <li class="breadcrumb-item active">Using the pydidas processing pipeline</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/manuals/gui/recipes/pydidas_processing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-the-pydidas-processing-pipeline">
<h1>Using the pydidas processing pipeline<a class="headerlink" href="#using-the-pydidas-processing-pipeline" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#detector-calibration" id="id8">1. Detector calibration</a></p></li>
<li><p><a class="reference internal" href="#define-the-experimental-setup" id="id9">2. Define the experimental setup</a></p>
<ul>
<li><p><a class="reference internal" href="#example" id="id10">Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#define-the-scan" id="id11">3. Define the scan</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id12">Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-the-workflow" id="id13">4. Creating the workflow</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id14">Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing-the-workflow" id="id15">5. Testing the workflow</a></p>
<ul>
<li><p><a class="reference internal" href="#plugin-details" id="id16">5.1 Plugin details</a></p></li>
<li><p><a class="reference internal" href="#tweaking-parameters" id="id17">5.2 Tweaking Parameters</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id18">Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-the-full-workflow" id="id19">6. Running the full workflow</a></p></li>
</ul>
</nav>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While setting up and using the pydidas processing pipeline is also available
from the command line, creating and editing the
<a class="reference internal" href="../../../code/api/workflow/workflow.html#pydidas.workflow.ProcessingTree" title="pydidas.workflow.processing_tree.ProcessingTree"><code class="xref py py-class docutils literal notranslate"><span class="pre">WorkflowTree</span></code></a>,
<a class="reference internal" href="../../../code/api/contexts.html#pydidas.contexts.diffraction_exp_context.DiffractionExperiment" title="pydidas.contexts.diffraction_exp_context.DiffractionExperiment"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiffractionExperimentContext</span></code></a>, and
<a class="reference internal" href="../../../code/api/contexts.html#pydidas.contexts.scan_context.Scan" title="pydidas.contexts.scan_context.Scan"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScanContext</span></code></a> are more easily
done in the graphical user interface and therefore, this guide covers
the GUI.</p>
</div>
<p>To process data from scratch, the following steps need to be performed:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Perform the detector calibration (in pyFAI geometry)</p></li>
<li><p>Define the experimental setup (X-ray energy, detector, geometry) using
the calibration.</p></li>
<li><p>Define the scan (paths, filenames and scanpoints).</p></li>
<li><p>Define the workflow which defines which operations to perform on the
data.</p></li>
<li><p>Test the workflow and tweak processing parameters (optional).</p></li>
<li><p>Run workflow and save results.</p></li>
</ol>
</div></blockquote>
<p>Each of the steps will be explained in detail below. Also, an example will be
used for demonstration of each step.</p>
<section id="detector-calibration">
<h2>1. Detector calibration<a class="headerlink" href="#detector-calibration" title="Link to this heading"></a></h2>
<p>The detector calibration can best be performed using the <em>pyFAI-calib2</em> tool.
A version of this tool is implemented in pydidas and can be accessed directly
through the toolbar menu on the left (circled in orange):</p>
<a class="reference internal image-reference" href="../../../_images/processing_01_calibration.png"><img alt="../../../_images/processing_01_calibration.png" class="align-center" src="../../../_images/processing_01_calibration.png" style="width: 400px;" /></a>
<p>For a tutorial on how to use the <em>pyFAI-calib2</em> tool, please refer directly
to the <a class="reference external" href="https://pyfai.readthedocs.io/en/master/usage/cookbook/calib-gui/index.html#cookbook-calibration-gui">pyFAI calibration tutorial</a>.</p>
</section>
<section id="define-the-experimental-setup">
<h2>2. Define the experimental setup<a class="headerlink" href="#define-the-experimental-setup" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../../_images/processing_02_experimental_setup.png"><img alt="../../../_images/processing_02_experimental_setup.png" class="align-left" src="../../../_images/processing_02_experimental_setup.png" style="width: 300px;" /></a>
<p>The pydidas frame to edit the experimental setup can be accessed through the
<em>Workflow processing</em> -&gt; <em>Define experimental setup</em> toolbar entries (marked
in orange on the left).</p>
<p>If you just performed the detector calibration, use the 2nd button from the top
<em>Copy all experimental parameters from calibration</em> to automatically update
all Parameter values, with the exception of the detector mask.</p>
<p>If you want to re-use a previous detector calibration, use the topmost button
<em>import experimerimental parameters from file</em> to open a file selection
dialogue. After confirming the selected file, the parameters are updated.
Note that the <em>detector mask file</em> parameter is not included in pyFAI’s
.poni file format and is not updated when importing a poni file.</p>
<p>The <em>detector mask file</em> must be set independently of the pyFAI calibration
parameter import, if it has not been set in the pyFAI calibration.</p>
<p>For more details, please refer to the <a class="reference internal" href="../frames/DefineDiffractionExpFrame.html#define-diffraction-exp-frame"><span class="std std-ref">DefineDiffractionExpFrame</span></a>
manual.</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h3>
<p>The example has been performed at an X-ray energy of 13 keV using an Eiger 9M
detector. This information was available from the beamline. The mask file for
the detector was saved at <em>E:testeiger_mask.npy</em> (in numpy binary format).
All the information was copied from the detector calibration.</p>
</section>
</section>
<section id="define-the-scan">
<h2>3. Define the scan<a class="headerlink" href="#define-the-scan" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../../_images/processing_03_scan_setup.png"><img alt="../../../_images/processing_03_scan_setup.png" class="align-center" src="../../../_images/processing_03_scan_setup.png" style="width: 400px;" /></a>
<p>Scan parameters and metadata can be edited on the <em>define scan</em> frame which can
be accessed through the <em>Workflow processing</em> -&gt; <em>Define scan</em> toolbar entries
(marked in orange in the image above).</p>
<p>All of the <em>global scan parameters</em> (except for the scan title) found in the
left column are mandatory, whereas on the number of scan points is mandatory
for each scan dimension.</p>
<p>The parameters for the scan base directory and naming pattern allow pydidas to
find the data and read the correct files. The number of scan points in each scan
dimension allows pydidas to re-arrange the input data in the correct shape.
The additional parameters for the individual scan dimensions are used for
annotating the results and for giving meaningful values to the dimensions but
they are not strictly necessary.</p>
<p>For more information, please refer to the <a class="reference internal" href="../frames/DefineScanFrame.html#define-scan-frame"><span class="std std-ref">Define scan frame</span></a> manual.</p>
<section id="id1">
<h3>Example<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>In the example used in the image above, the individual image files are located
in the E:testraw directory and the data files are named test_00010_data.h5,
test_00011_data.h5, etc. (therefore, the starting index is set to 10).</p>
<p>One image was acquired at each scan point in a mesh of 25 x 25 points.</p>
</section>
</section>
<section id="creating-the-workflow">
<h2>4. Creating the workflow<a class="headerlink" href="#creating-the-workflow" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../../_images/processing_04_workflow_setup.png"><img alt="../../../_images/processing_04_workflow_setup.png" class="align-center" src="../../../_images/processing_04_workflow_setup.png" style="width: 400px;" /></a>
<p>To create the workflow, select the <em>Workflow processing</em> - &gt; <em>Workflow editing</em>
toolbar entry (marked in orange in the image above).
The workflow is comprised of individual plugins which each perform a single
task, like frame loading, azimuthal integration, background correction,
peak fitting. The workflow can branch downward in an unlimited number of nodes
(subject to processing resources).</p>
<p>Use the Plugin browser at the bottom of the frame to display more information
about and to select plugins. Double click on any plugin to add it as child to
the current plugin or use the right mouse button on a Plugin to open a menu with
additional options.</p>
<p>Clicking on a plugin in the field at the top selects it and opens these plugin’s
parameters on the right side for editing. Plugins can also be rearranged by
drag &amp; drop.</p>
<p>For additional information, please refer to the <a class="reference internal" href="../frames/WorkflowEditFrame.html#workflow-edit-frame"><span class="std std-ref">Workflow edit frame</span></a>
manual.</p>
<p>Note that pydidas by default only stores the result of leaves (i.e. plugins
which have no children). If you want to store additional results, please set the
<em>Always store results</em> parameter to <code class="xref py py-data docutils literal notranslate"><span class="pre">True</span></code>.</p>
<section id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>In the example used above, the plugins have been used with most of their default
settings. Only the radial integration has been limited to [5, 30] degrees in the
<em>pyFAI azimuthal integration</em> plugin (to have a region with a smooth background
which can be well subtracted) and the <em>Fit single peak</em> has been changed to use
a Lorentzian function and to set the limits.</p>
</section>
</section>
<section id="testing-the-workflow">
<h2>5. Testing the workflow<a class="headerlink" href="#testing-the-workflow" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../../_images/processing_05_workflow_test.png"><img alt="../../../_images/processing_05_workflow_test.png" class="align-center" src="../../../_images/processing_05_workflow_test.png" style="width: 400px;" /></a>
<p>Once the parameters for Experiment, Scan and and Workflow have been configured,
the Workflow can be tested. Select the <em>Workflow processing</em> - &gt; <em>Test Workflow</em>
toolbar entry (marked in orange in the image above).</p>
<p>Pick a good datapoint by using either the image number or scan indices and click
the button <em>Process frame</em> to run the workflow locally. Note: To avoid overhead,
the workflow is executed in the same process and is blocking. Especially using
any pyFAI integration for the first time will require a few seconds to set up
the matrix tables.</p>
<p>The <em>Results</em> dropdown selection allows to see the results for any plugin in the
workflow. The textbox on the left gives you additional information about the
plugin results, the window on the right plots the 2d image or 1d curve.
If you are not happy with the results, select the <em>Tweak plugin
parameters</em> button at the bottom to open a new window and edit this plugin’s
parameters.</p>
<section id="plugin-details">
<h3>5.1 Plugin details<a class="headerlink" href="#plugin-details" title="Link to this heading"></a></h3>
<p>Some plugins allow to inspect detailed results which can be anything and which
are defined in each plugin. The <em>Show detailed results for plugin</em> button opens
a new window with the details for the selected plugin.</p>
<a class="reference internal image-reference" href="../../../_images/processing_05a_workflow_test_details.png"><img alt="../../../_images/processing_05a_workflow_test_details.png" class="align-center" src="../../../_images/processing_05a_workflow_test_details.png" style="width: 400px;" /></a>
<p>Depending on the plugin, several images or plots can be shown in this window.
All plots are labelled. More information, including a legend, can be accessed
through the <em>Options</em> at the bottom of the plot.</p>
</section>
<section id="tweaking-parameters">
<h3>5.2 Tweaking Parameters<a class="headerlink" href="#tweaking-parameters" title="Link to this heading"></a></h3>
<p>Using the <em>Tweak plugin parameters</em> button on the <em>Test Workflow</em> frame opens
a new window which allows to modify Plugin parameters in place.</p>
<a class="reference internal image-reference" href="../../../_images/processing_05b_workflow_test_tweak.png"><img alt="../../../_images/processing_05b_workflow_test_tweak.png" class="align-center" src="../../../_images/processing_05b_workflow_test_tweak.png" style="width: 400px;" /></a>
<p>The <em>Run plugin with current parameters</em> will run the current plugin only and
display its results (and its details, if the plugin has them defined). Once
you have configured the plugin to your wishes, use the <em>Confirm current
parameters and close window</em> button. This will also run any child plugins with
the updated input data again.</p>
</section>
<section id="id3">
<h3>Example<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>The resulting outputs for each plugin in the workflow are shown below:</p>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../../../_images/processing_05c_workflow_test_loader.png"><img alt="../../../_images/processing_05c_workflow_test_loader.png" src="../../../_images/processing_05c_workflow_test_loader.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text">The imported image from the loader.</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../../../_images/processing_05d_workflow_test_integration.png"><img alt="../../../_images/processing_05d_workflow_test_integration.png" src="../../../_images/processing_05d_workflow_test_integration.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text">The azimuthally integrated data.</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id6">
<a class="reference internal image-reference" href="../../../_images/processing_05e_workflow_test_outlier_removal.png"><img alt="../../../_images/processing_05e_workflow_test_outlier_removal.png" src="../../../_images/processing_05e_workflow_test_outlier_removal.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text">The data after outlier removal.</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../../../_images/processing_05f_workflow_test_bg_removal.png"><img alt="../../../_images/processing_05f_workflow_test_bg_removal.png" src="../../../_images/processing_05f_workflow_test_bg_removal.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text">The data after polynomial background removal.</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="running-the-full-workflow">
<h2>6. Running the full workflow<a class="headerlink" href="#running-the-full-workflow" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../../_images/processing_06_workflow_run.png"><img alt="../../../_images/processing_06_workflow_run.png" class="align-center" src="../../../_images/processing_06_workflow_run.png" style="width: 400px;" /></a>
<p>Once you are confident that everything is configured correctly, select the
<em>Workflow processing</em> - &gt; <em>Run full Workflow</em> toolbar entry (marked in orange
in the image above). This will open the <em>Run full workflow</em> frame which allows
to run the workflow in separate processes in the background and to visualize
the results.</p>
<p>The <em>Start processing</em> button opens background processes, which perform the
actual processing and only communicate their results. Starting these processes
takes some time and once results come in, you can select one of the nodes from
the drop-down on the left to display their results. For details, please refer
to the <a class="reference internal" href="../frames/WorkflowRunFrame.html#workflow-run-frame"><span class="std std-ref">Run full workflow frame manual</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../frames/CompositeCreatorFrame.html" class="btn btn-neutral float-left" title="Composite image creator frame" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../code/code_documentation.html" class="btn btn-neutral float-right" title="Code documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Helmholtz-Zentrum Hereon.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XXXXXXXXXX', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>