<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial for the CompositeCreatorApp &mdash; pydidas</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/_css/pydidas-custom.css?v=7afb26e6" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=853907ea"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tutorial for the ExecuteWorkflowApp" href="cmd_execute_workflow_app.html" />
    <link rel="prev" title="Running pydidas applications" href="cmd_running_apps.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #4444AA" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pydidas
              <img src="../../_static/pydidas_snakes_circ_bg.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                "24.06.05"
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Pydidas quick-start guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../manuals.html">Manuals</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../commandline.html">Command line manuals</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../cmdline_global/cmd_global.html">pydidas general command line tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmdline_global/cmd_diffraction_exp_context.html">The DiffractionExperimentContext class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmdline_global/cmd_scan_context.html">The ScanContext class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmdline_global/cmd_workflow_tree.html">The WorkflowTree class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmdline_global/cmd_workflow_results.html">The WorkflowResults class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmdline_global/cmd_running_workflows.html">Running pydidas workflows from the command line</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="cmd_apps.html">Command line applications</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="cmd_running_apps.html">Running pydidas applications</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Tutorial for the CompositeCreatorApp</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#motivation">Motivation</a></li>
<li class="toctree-l5"><a class="reference internal" href="#globally-controlled-settings">Globally controlled settings</a></li>
<li class="toctree-l5"><a class="reference internal" href="#setup-of-the-compositecreatorapp">Setup of the CompositeCreatorApp</a></li>
<li class="toctree-l5"><a class="reference internal" href="#running-the-compositecreatorapp">Running the CompositeCreatorApp</a></li>
<li class="toctree-l5"><a class="reference internal" href="#accessing-results">Accessing results</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="cmd_execute_workflow_app.html">Tutorial for the ExecuteWorkflowApp</a></li>
<li class="toctree-l4"><a class="reference internal" href="cmd_directory_spy_app.html">Tutorial for the DirectorySpyApp</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../gui/graphical_user_interface.html">Graphical user interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../code/code_documentation.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide.html">Developer guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #4444AA" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pydidas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../manuals.html">Manuals</a></li>
          <li class="breadcrumb-item"><a href="../commandline.html">Command line manuals</a></li>
          <li class="breadcrumb-item"><a href="cmd_apps.html">Command line applications</a></li>
      <li class="breadcrumb-item active">Tutorial for the CompositeCreatorApp</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/manuals/cmdline_apps/cmd_composite_creator_app.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial-for-the-compositecreatorapp">
<h1>Tutorial for the CompositeCreatorApp<a class="headerlink" href="#tutorial-for-the-compositecreatorapp" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#motivation" id="id1">Motivation</a></p></li>
<li><p><a class="reference internal" href="#globally-controlled-settings" id="id2">Globally controlled settings</a></p></li>
<li><p><a class="reference internal" href="#setup-of-the-compositecreatorapp" id="id3">Setup of the CompositeCreatorApp</a></p>
<ul>
<li><p><a class="reference internal" href="#selection-of-input-data" id="id4">Selection of input data</a></p></li>
<li><p><a class="reference internal" href="#using-a-mask-file" id="id5">Using a mask file</a></p></li>
<li><p><a class="reference internal" href="#using-a-background-file" id="id6">Using a background file</a></p></li>
<li><p><a class="reference internal" href="#using-a-region-of-interest" id="id7">Using a region of interest</a></p></li>
<li><p><a class="reference internal" href="#use-binning" id="id8">Use binning</a></p></li>
<li><p><a class="reference internal" href="#image-thresholds" id="id9">Image thresholds</a></p></li>
<li><p><a class="reference internal" href="#composite-layout" id="id10">Composite layout</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-the-compositecreatorapp" id="id11">Running the CompositeCreatorApp</a></p></li>
<li><p><a class="reference internal" href="#accessing-results" id="id12">Accessing results</a></p>
<ul>
<li><p><a class="reference internal" href="#accessing-results-within-python" id="id13">Accessing results within Python</a></p></li>
<li><p><a class="reference internal" href="#exporting-results" id="id14">Exporting results</a></p></li>
<li><p><a class="reference internal" href="#complete-list-of-compositecreatorapp-parameters" id="id15">Complete list of CompositeCreatorApp Parameters</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading"></a></h2>
<p>The <a class="reference internal" href="../../code/api/apps/composite_creator_app.html#pydidas.apps.CompositeCreatorApp" title="pydidas.apps.CompositeCreatorApp"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeCreatorApp</span></code></a> is
designed to combine multiple images into a composite image. Only basic
operations of binning and cropping are applied to the raw images.
Global offsets in the image data can be handled with a mask and background file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the use of different Parameters is handled in different sections of
this manual, they must all be combined to use all capabilities of the
<a class="reference internal" href="../../code/api/apps/composite_creator_app.html#pydidas.apps.CompositeCreatorApp" title="pydidas.apps.CompositeCreatorApp"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeCreatorApp</span></code></a>.</p>
</div>
</section>
<section id="globally-controlled-settings">
<h2>Globally controlled settings<a class="headerlink" href="#globally-controlled-settings" title="Link to this heading"></a></h2>
<p>Some settings used by the CompositeCreatorApp are controlled globally by pydidas.
These are:</p>
<ul class="simple">
<li><p>The width of the border between images in pixels
(<cite>user/mosaic_border_width</cite>)</p></li>
<li><p>The value of the border pixels (<cite>user/mosaic_border_value</cite>)</p></li>
<li><p>The maximum image size in megapixels (<cite>global/max_image_size</cite>)</p></li>
<li><p>The path for the detector mask file (<cite>user/det_mask</cite>)</p></li>
<li><p>The pixel value for masked pixels (<cite>user/det_mask_val</cite>)</p></li>
</ul>
<p>and for parallel processing additionally:</p>
<ul class="simple">
<li><p>The number of parallel worker processes (<cite>global/mp_n_workers</cite>)</p></li>
</ul>
<p>Because these settings will typically be reused quite often, they have been
implemented as global <a class="reference internal" href="../cmdline_global/cmd_global.html#pydidas-qsettings"><span class="std std-ref">pydidas QSettings</span></a>. The default is a border width
of 0 pixels and a border pixel value of 0. The default maximum size is 100 Mpx.
To modify these values, the user needs to create a QSettings instance and adjust
these values, if required:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PydidasQsettings</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;user/mosaic_border_width&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;user/mosaic_border_value&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;global/max_image_size&#39;</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="setup-of-the-compositecreatorapp">
<h2>Setup of the CompositeCreatorApp<a class="headerlink" href="#setup-of-the-compositecreatorapp" title="Link to this heading"></a></h2>
<p>This section describes the different input Parameters that can be used and gives
an overview of the <a class="reference internal" href="#composite-creator-app-params"><span class="std std-ref">Complete list of CompositeCreatorApp Parameters</span></a> at the end of the
section.</p>
<section id="selection-of-input-data">
<h3>Selection of input data<a class="headerlink" href="#selection-of-input-data" title="Link to this heading"></a></h3>
<p>First of all, the user needs to define whether the app will be run in
<code class="xref py py-data docutils literal notranslate"><span class="pre">live_processing</span></code> mode or not. This flag defines whether checks for
file existance and size will be performed before the start of the processing.
The default setting is <code class="xref py py-data docutils literal notranslate"><span class="pre">False</span></code> which will enforce file system checks.
This value is stored in the <code class="xref py py-data docutils literal notranslate"><span class="pre">live_processing</span></code>
<a class="reference internal" href="../../code/api/core/parameter.html#pydidas.core.Parameter" title="pydidas.core.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a>
(see <a class="reference internal" href="#composite-creator-app-params"><span class="std std-ref">Complete list of CompositeCreatorApp Parameters</span></a> for details).</p>
<p>The input data is defined through the files to use by defining the first and
last file (or only one file if a file with multiple frames per file is used,
e.g. hdf5). The file(s) must be selected by the <code class="xref py py-data docutils literal notranslate"><span class="pre">first_file</span></code> and
<code class="xref py py-data docutils literal notranslate"><span class="pre">last_file</span></code> <a class="reference internal" href="../../code/api/core/parameter.html#pydidas.core.Parameter" title="pydidas.core.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameters</span></code></a>. If not
every file single but only every n-th file should be processed, this
can be defined by the <code class="xref py py-data docutils literal notranslate"><span class="pre">file_stepping</span></code> Parameter. pydidas will check the
filenames for running numbers and determine the names automatically.
Incrementing numbers do not need to be given by wildcards but must be separated
by a delimiter of “.” or “_” or “-” or “ “.</p>
<p>Note that the first file must exist at the time the app is run because the file
size will be used as reference for the future files.</p>
<p>For hdf5 files, the hdf5 dataset needs to be specified as well. The dataset
can be given with the <code class="xref py py-data docutils literal notranslate"><span class="pre">hdf5_key</span></code> Parameter. The default is
<em>entry/data/data</em> and if this is correct, the Parameter does not need to be
specified. A subset of images from hdf5 files can be selected by using the
<code class="xref py py-data docutils literal notranslate"><span class="pre">hdf5_first_image_num</span></code> and <code class="xref py py-data docutils literal notranslate"><span class="pre">hdf5_last_image_num</span></code> Parameters
with a frame stepping of <code class="xref py py-data docutils literal notranslate"><span class="pre">hdf5_stepping</span></code>.</p>
<p>See <a class="reference internal" href="#composite-creator-app-params"><span class="std std-ref">Complete list of CompositeCreatorApp Parameters</span></a> for the detailed list of all Parameters.</p>
<section id="example-1-loading-a-number-of-tiff-files">
<h4>Example 1: Loading a number of tiff files<a class="headerlink" href="#example-1-loading-a-number-of-tiff-files" title="Link to this heading"></a></h4>
<p>For the first example, we want to load every 3rd file from a running scan
which produces tiff files named <em>/scratch/scan_42/test_image_0000_suffix.tiff</em>
to <em>/scratch/scan_42/test_image_1200_suffix.tiff</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;first_file&#39;</span><span class="p">,</span> <span class="s1">&#39;/scratch/scan_42/test_image_0000_suffix.tiff&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;last_file&#39;</span><span class="p">,</span> <span class="s1">&#39;/scratch/scan_42/test_image_1200_suffix.tiff&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;file_stepping&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;live_processing&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Once started, this app will run until the file
<em>/scratch/scan_42/test_image_1200_suffix.tiff</em> has been created and processed.</p>
</section>
<section id="example-2-loading-a-subset-of-frames-from-a-single-hdf5-file">
<h4>Example 2: Loading a subset of frames from a single hdf5 file<a class="headerlink" href="#example-2-loading-a-subset-of-frames-from-a-single-hdf5-file" title="Link to this heading"></a></h4>
<p>For this example, we want to load every 2nd frame for the frames 10 to 30 from
a single hdf5 file named <em>/scratch/test_scan/some_file.h5</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;first_file&#39;</span><span class="p">,</span> <span class="s1">&#39;/scratch/test_scan/some_file.h5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;hdf5_first_image_num&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;hdf5_last_image_num&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;hdf5_stepping&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="using-a-mask-file">
<h3>Using a mask file<a class="headerlink" href="#using-a-mask-file" title="Link to this heading"></a></h3>
<p>A mask file can be used by activating the <code class="xref py py-data docutils literal notranslate"><span class="pre">use_global_det_mask</span></code>
Parameter. This will instruct the app to apply the global mask to the data
frame. For more information on the global settings, please refer to
<a class="reference internal" href="../cmdline_global/cmd_global.html#pydidas-qsettings"><span class="std std-ref">pydidas QSettings</span></a>. The filename for the mask file must be given with the
<em>user/det_mask</em> value and the value for the masked pixels by the
<em>user/det_mask_val</em>.</p>
<p>The example below shows the code to instruct the app to use the
<em>/scratch/det_mask.npy</em> file and substitute masked pixels with a value of zero.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PydidasQsettings</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;user/det_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;/scratch/det_mask.npy&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s1">&#39;user/det_mask_val&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;use_global_det_mask&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="using-a-background-file">
<h3>Using a background file<a class="headerlink" href="#using-a-background-file" title="Link to this heading"></a></h3>
<p>Usage of a background file (which will be subtracted from all frames) can be
activated by setting the <code class="xref py py-data docutils literal notranslate"><span class="pre">use_bg_file</span></code> Parameter to <code class="xref py py-data docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>The background file itself can be selected by specifying the <code class="xref py py-data docutils literal notranslate"><span class="pre">bg_file</span></code>
Parameter. If a hdf5 file is selected, the dataset and frame can be given by
the <code class="xref py py-data docutils literal notranslate"><span class="pre">bg_hdf5_key</span></code> and <code class="xref py py-data docutils literal notranslate"><span class="pre">bg_hdf5_frame</span></code>. These values default to
<em>entry/data/data</em> and 0, respectively.</p>
<p>As example, let us use the 0th frame from the <em>/scratch/scan_42/test.h5df5</em>
file and the <em>entry/detector/data</em> dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;use_bg_file&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;bg_file&#39;</span><span class="p">,</span> <span class="s1">&#39;/scratch/scan_42/test.h5df5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;bg_hdf5_key&#39;</span><span class="p">,</span> <span class="s1">&#39;entry/detector/data&#39;</span><span class="p">)</span>
<span class="go"># Because the bg_hdf5_frame defaults to 0, this Parameter does not need to</span>
<span class="go"># be modified:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">get_param_value</span><span class="p">(</span><span class="s1">&#39;bg_hdf5_frame&#39;</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
</section>
<section id="using-a-region-of-interest">
<h3>Using a region of interest<a class="headerlink" href="#using-a-region-of-interest" title="Link to this heading"></a></h3>
<p>A region of interest (ROI) can be selected by defining the four values for
lower and upper pixels in <em>x</em> and <em>y</em>. Usage of the ROI must be activated by
setting the Parameter <code class="xref py py-data docutils literal notranslate"><span class="pre">use_roi</span></code> to <code class="xref py py-data docutils literal notranslate"><span class="pre">True</span></code>. The four
boundaries can be defined by the <code class="xref py py-data docutils literal notranslate"><span class="pre">roi_xlow</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">roi_xhigh</span></code>,
<code class="xref py py-data docutils literal notranslate"><span class="pre">roi_ylow</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">roi_yhigh</span></code> values. To use the full range, use
<code class="xref py py-data docutils literal notranslate"><span class="pre">None</span></code> as value for the high boundaries and <code class="xref py py-data docutils literal notranslate"><span class="pre">0</span></code> for the low
boundaries.
These values are modulated by the image width and height, respectively. A value
of <code class="xref py py-data docutils literal notranslate"><span class="pre">roi_yhigh</span> <span class="pre">=</span> <span class="pre">-5</span></code> thus corresponds to cropping the five rightmost pixel
rows.</p>
<p>The defaults are <code class="xref py py-data docutils literal notranslate"><span class="pre">roi_xlow</span> <span class="pre">=</span> <span class="pre">0</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">roi_xhigh</span> <span class="pre">=</span> <span class="pre">None</span></code>,
<code class="xref py py-data docutils literal notranslate"><span class="pre">roi_ylow</span> <span class="pre">=</span> <span class="pre">0</span></code>, and <code class="xref py py-data docutils literal notranslate"><span class="pre">roi_yhigh</span> <span class="pre">=</span> <span class="pre">None</span></code>. Note that if the ROI
is activated, all four values are used and need to be set correctly.</p>
<p>As example, let the input image be of size 1000 x 1000 and let us select a
ROI of pixel rows 5 to 1000 in height and the pixel columns 120 to 900 in
width.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;use_roi&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="go"># Set up the ROI in x:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;roi_xlow&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;roi_xhigh&#39;</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
<span class="go"># Because we know the image size is 1000, a value of -100 for roi_xhigh</span>
<span class="go"># has the same effect as 900.</span>

<span class="go"># Set up the ROI in y:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;roi_ylow&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="go"># We do not need to specify a roi_yhigh value because the default of None</span>
<span class="go"># corresponds to the full height as upper y boundary:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">get_param_value</span><span class="p">(</span><span class="s1">&#39;roi_yhigh&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
<section id="use-binning">
<h3>Use binning<a class="headerlink" href="#use-binning" title="Link to this heading"></a></h3>
<p>Images can be binned to reduce their size in the composite image. This operation
is controlled by the <code class="xref py py-data docutils literal notranslate"><span class="pre">binning</span></code> Parameter. A value of 1 corresponds to
the input size and is ignored. The binning must be an integer value.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If a combination of binning and ROI is used, the ROI pixel coordinates
refer to the unbinned image.</p>
</div>
<p>As example, we set the binning factor to re-bin images by a factor of 4 in the
composite image:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;binning&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="image-thresholds">
<h3>Image thresholds<a class="headerlink" href="#image-thresholds" title="Link to this heading"></a></h3>
<p>The range of the composite image can be restricted by using thresholds. Two
thresholds for the upper and lower value must be given. To activate the use
of thresholds, set the <code class="xref py py-data docutils literal notranslate"><span class="pre">use_thresholds</span></code> Parameter to <code class="xref py py-data docutils literal notranslate"><span class="pre">True</span></code>.
The values for the lower and upper thresholds are given by the
<code class="xref py py-data docutils literal notranslate"><span class="pre">threshold_low</span></code> and <code class="xref py py-data docutils literal notranslate"><span class="pre">threshold_high</span></code> Parameters, respectively.
A value of <code class="xref py py-data docutils literal notranslate"><span class="pre">None</span></code> for a threshold  will disable this specific
threshold. The default value for threshold values is <code class="xref py py-data docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>As example, let us define an upper threshold of 42.0 and disable the lower
threshold.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;use_thresholds&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;threshold_high&#39;</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">)</span>

<span class="go"># The lower thresholds&#39;s default value is None, which will make the app</span>
<span class="go"># ignore this threshold and it does not need to be changed:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">get_param_value</span><span class="p">(</span><span class="s1">&#39;threshold_low&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
<section id="composite-layout">
<h3>Composite layout<a class="headerlink" href="#composite-layout" title="Link to this heading"></a></h3>
<p>The arrangement of the images in the resulting mosaic image are controlled by
the <code class="xref py py-data docutils literal notranslate"><span class="pre">composite_nx</span></code> and <code class="xref py py-data docutils literal notranslate"><span class="pre">composite_ny</span></code> Parameters. These
control the number of individual images in the <em>x</em> and <em>y</em> directions,
respectively. The numbers must be chosen in a manner that the total number
<span class="math notranslate nohighlight">\(N_{total}\)</span> is less or equal to the product <span class="math notranslate nohighlight">\(N_x * N_y\)</span> but is not
unnecessary large. Mathematically, the two following conditions need to be
fulfilled:</p>
<div class="math notranslate nohighlight">
\[\begin{split}N_x * (N_y - 1) &amp;&lt; N_{total} &lt;= N_x * N_y \\
(N_x - 1) * N_y &amp;&lt; N_{total} &lt;= N_x * N_y\end{split}\]</div>
<p>One dimension can be automatically adjusted in size by using the value <em>-1</em>. The
default values are <cite>Nx = 1</cite> and <cite>Ny = -1</cite>.</p>
<p>In addition, raw images can be flipped or rotated prior to inserting them into
the composite. The <code class="xref py py-data docutils literal notranslate"><span class="pre">composite_image_op</span></code> Parameter allows to select the
type of operation to be performed (if any).</p>
<p>The <em>order</em> in which the images are inserted in the composite can be controlled
by the <code class="xref py py-data docutils literal notranslate"><span class="pre">composite_xdir_orientation</span></code> and
<code class="xref py py-data docutils literal notranslate"><span class="pre">composite_ydir_orientation</span></code> Parameters which allow to select if images
are added from the left or right and top or bottom border, respectively.</p>
<p>As example, we want to create a composite with a number of twenty images in y
and we want to adjust x automatically.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;composite_nx&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;composite_ny&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>As second example, we want to create a composite of 90 images with 10 images
in y and starting at the left side in x.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;composite_nx&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;composite_ny&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">set_param_value</span><span class="p">(</span><span class="s1">&#39;composite_xdir_orientation&#39;</span><span class="p">,</span> <span class="s1">&#39;right-to-left&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Mathematically, it is equivalent to change the orientation of the raw
images or to change the order of the images in the composite. However,
users might prefer to have the composite composed in the same orientation
as their raw data scan.</p>
</div>
</section>
</section>
<section id="running-the-compositecreatorapp">
<h2>Running the CompositeCreatorApp<a class="headerlink" href="#running-the-compositecreatorapp" title="Link to this heading"></a></h2>
<p>Once configured, the <a class="reference internal" href="../../code/api/apps/composite_creator_app.html#pydidas.apps.CompositeCreatorApp" title="pydidas.apps.CompositeCreatorApp"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeCreatorApp</span></code></a>
is run like any pydidas app, as described in detail in
<a class="reference internal" href="cmd_running_apps.html#running-pydidas-applications"><span class="std std-ref">Running pydidas applications</span></a>.</p>
<p>As a recap, to run the app serially, use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">run</span>
<span class="pre">&lt;pydidas.apps.CompositeCreatorApp.run()</span></code> method:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pydidas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>To run it utilizing parallelization, set up an
<a class="reference internal" href="../../code/api/multiprocessing.html#pydidas.multiprocessing.AppRunner" title="pydidas.multiprocessing.AppRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppRunner</span></code></a> and use its
:py:meth`start &lt;pydidas.multiprocessing.AppRunner.start&gt;` method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">CompositeCreatorApp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">runner</span> <span class="o">=</span> <span class="n">pydidas</span><span class="o">.</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">AppRunner</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">runner</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>
</pre></div>
</div>
<p>If any thresholding should be performed, this operation needs to be called on
the app by the <code class="xref py py-data docutils literal notranslate"><span class="pre">apply_thresholds</span></code> method. Note that it is also
possible to provide new threshold values. Please see the
<a class="reference internal" href="../../code/api/apps/composite_creator_app.html#pydidas.apps.CompositeCreatorApp.apply_thresholds" title="pydidas.apps.CompositeCreatorApp.apply_thresholds"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_thresholds</span></code></a>
documentation for this.</p>
<p>Simply call the method to update the composite image with the thresholds
provided by the associated Parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># To apply the thresholds</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">app</span><span class="o">.</span><span class="n">apply_threshold</span><span class="p">()</span>

<span class="c1"># to apply new threshold values:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">app</span><span class="o">.</span><span class="n">apply_thresholds</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the <code class="xref py py-data docutils literal notranslate"><span class="pre">use_thresholds</span></code> Parameter is value <code class="xref py py-data docutils literal notranslate"><span class="pre">False</span></code>,
calling the <a class="reference internal" href="../../code/api/apps/composite_creator_app.html#pydidas.apps.CompositeCreatorApp.apply_thresholds" title="pydidas.apps.CompositeCreatorApp.apply_thresholds"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_thresholds</span></code></a> method will have no
effect.</p>
</div>
</section>
<section id="accessing-results">
<h2>Accessing results<a class="headerlink" href="#accessing-results" title="Link to this heading"></a></h2>
<p>After running the
<a class="reference internal" href="../../code/api/apps/composite_creator_app.html#pydidas.apps.CompositeCreatorApp" title="pydidas.apps.CompositeCreatorApp"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeCreatorApp</span></code></a>, results can
be accessed either directly to store the object for further use in the Python
console or script or they can be stored.</p>
<section id="accessing-results-within-python">
<h3>Accessing results within Python<a class="headerlink" href="#accessing-results-within-python" title="Link to this heading"></a></h3>
<p>The results can be accessed through the <code class="xref py py-data docutils literal notranslate"><span class="pre">composite</span></code> property which
will return the array with the image data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">composite</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="go">numpy.ndarray</span>
</pre></div>
</div>
</section>
<section id="exporting-results">
<h3>Exporting results<a class="headerlink" href="#exporting-results" title="Link to this heading"></a></h3>
<p>Results can be exported by using the <a class="reference internal" href="../../code/api/apps/composite_creator_app.html#pydidas.apps.CompositeCreatorApp.export_image" title="pydidas.apps.CompositeCreatorApp.export_image"><code class="xref py py-meth docutils literal notranslate"><span class="pre">export_image</span></code></a> method in any format known to
pydidas. The format is determined automatically from the extension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># To export in numpy format:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">app</span><span class="o">.</span><span class="n">export_image</span><span class="p">(</span><span class="s1">&#39;/scratch/image.npy&#39;</span><span class="p">)</span>

<span class="c1"># or to export as tiff</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">app</span><span class="o">.</span><span class="n">export_image</span><span class="p">(</span><span class="s1">&#39;/scratch/image.tiff&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="complete-list-of-compositecreatorapp-parameters">
<span id="composite-creator-app-params"></span><h3>Complete list of CompositeCreatorApp Parameters<a class="headerlink" href="#complete-list-of-compositecreatorapp-parameters" title="Link to this heading"></a></h3>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cmd_running_apps.html" class="btn btn-neutral float-left" title="Running pydidas applications" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cmd_execute_workflow_app.html" class="btn btn-neutral float-right" title="Tutorial for the ExecuteWorkflowApp" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 - 2024, Helmholtz-Zentrum Hereon.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XXXXXXXXXX', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>